unit cliente.controller;

interface

uses cliente.model, clienterepository.model, conexao.model, System.SysUtils, FireDAC.Comp.Client, FireDAC.Stan.Param,
  Data.DB;

type
  TCampoInvalido = (ciData, ciCliente, ciValor, ciValorZero);
  TClienteController = class

  private
    FCliente: TCliente;
    FClienteRepo : TClienteRepository;

  public
    constructor Create();
    destructor Destroy; override;
    procedure PreencherGrid(APesquisa, ACampo: string);
    procedure PreencherComboCliente;
    procedure CarregarCampos(FCliente: TCliente; ACodigo: Integer);
    function Inserir(FCliente: TCliente; out sErro: string): Boolean;
    function Alterar(FCliente: TCliente; ACodigo: Integer; out sErro: string): Boolean;
    function Excluir(ACodigo: Integer; out sErro : string): Boolean;
    function GetDataSource: TDataSource;

  end;


implementation

{ TClienteController }

constructor TClienteController.Create;
begin
  FCliente := TCliente.Create();
  FClienteRepo := TClienteRepository.Create();
end;

destructor TClienteController.Destroy;
begin
  FCliente.Free;
  FClienteRepo.Free;
  inherited;
end;

procedure TClienteController.PreencherGrid(APesquisa, ACampo: string);
var LCampo, SErro: string;
begin
  try
    if ACampo = 'Código' then
      LCampo := 'cli.cd_cliente';

    if ACampo = 'Nome' then
      LCampo := 'cli.des_nomecliente';

    if ACampo = 'Cidade' then
      LCampo := 'cli.des_cidade';

    if ACampo = '' then
      LCampo := 'cli.des_nomecliente';

    FClienteRepo.PreencherGrid(APesquisa, LCampo);
  except on E: Exception do
    begin
      SErro := 'Ocorreu um erro ao pesquisar a venda!' + sLineBreak + E.Message;
      raise;
    end;
  end;
end;

procedure TClienteController.PreencherComboCliente;
begin
  FClienteRepo.PreencherComboCliente();
end;

function TClienteController.Inserir(FCliente: TCliente; out sErro: string): Boolean;
begin

end;

procedure TClienteController.CarregarCampos(FCliente: TCliente; ACodigo: Integer);
begin

end;

function TClienteController.Alterar(FCliente: TCliente; ACodigo: Integer; out sErro: string): Boolean;
begin

end;

function TClienteController.Excluir(ACodigo: Integer; out sErro: string): Boolean;
begin

end;


function TClienteController.GetDataSource: TDataSource;
begin
  Result := FClienteRepo.GetDataSource;
end;

end.
